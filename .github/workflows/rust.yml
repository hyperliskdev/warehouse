name: PostgreSQL and Rust CI

on: [ push, pull_request ]

env:
  CARGO_TERM_COLOR: always

jobs:

  psql-job:
    runs-on: ubuntu-latest
    services:
      postgres:
        image: postgres
        env:
          POSTGRES_PASSWORD: postgres
          POSTGRES_USER: postgres
          POSTGRES_HOST: localhost
          POSTGRES_PORT: 5432
    
    steps:
      - name: Checkout warehouse code repo
        uses: actions/checkout@v3
        
      - name: SQLx Create DB
        run: cargo sqlx database create
        
      - name: Run SQL Migration
        run: cargo sqlx migrate run
        
      
